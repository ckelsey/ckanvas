!function(e){e.directive("ckanvas",["$compile",function(e){return{restrict:"E",scope:{paths:"=paths",transformControls:"@transformControls",miniMap:"@miniMap",zoom:"@zoom",offsetX:"@offsetX",offsetY:"@offsetY",center:"@center",responsive:"@responsive"},link:function(t,o,n){var i=null,s=null,a=function(){t.zoom<1&&(t.zoom=1),1===t.zoom?s.className=-1===s.className.indexOf("c-ckanvas__zoom-button-disabled")?s.className+" c-ckanvas__zoom-button-disabled":s.className:s.className=s.className.split("c-ckanvas__zoom-button-disabled").join("");var e="translate("+(t.offsetX?t.offsetX+"px":"0px")+", "+(t.offsetY?t.offsetY+"px":"0px")+") scale("+(t.zoom?t.zoom:"1")+")",o=50,n=50;t.offsetX&&(o=(i.width-t.offsetX)/i.width*100-90),t.offsetY&&(n=(i.height-t.offsetY)/i.height*100-50),transformOrigin=o+"% "+n+"%",i.style.webkitTransform=e,i.style.webkitTransformOrigin=transformOrigin},r=function(e){e.target;document.body.removeEventListener("mousemove",l,!0),document.body.removeEventListener("mouseleave",r,!0),document.body.removeEventListener("mouseup",r,!0)},c=0,f=0,l=function(e){var o=e.pageX-i.getBoundingClientRect().left,n=e.pageY-i.getBoundingClientRect().top;t.offsetX=t.offsetX+(o-c),t.offsetY=t.offsetY+(n-f),a()},v=function(e){c=e.pageX-i.getBoundingClientRect().left,f=e.pageY-i.getBoundingClientRect().top,document.body.addEventListener("mousemove",l,!0),document.body.addEventListener("mouseleave",r,!0),document.body.addEventListener("mouseup",r,!0)},u=function(e,t,o){for(var n in o[e].properties)t[n]=o[e].properties[n];t.beginPath(),t.moveTo(o[e].vertices[0][0],o[e].vertices[0][1]);for(var i=1;i<o[e].vertices.length;i++){var s=o[e].vertices[i][0],a=o[e].vertices[i][1];t.lineTo(s,a)}t.closePath(),o[e].properties.fillStyle&&t.fill(),o[e].properties.strokeStyle&&t.stroke()},d=function(e,t,o,n,i){for(var s=0;s<i.length;s++)i[s][0]>t&&(t=i[s][0]),i[s][0]<e&&(e=i[s][0]),i[s][1]>n&&(n=i[s][1]),i[s][1]<o&&(o=i[s][1]);return{x:e,X:t,y:o,Y:n}},m=function(e){for(var t=0;t<e.length;t++)for(var o=0;o<e[t].vertices.length;o++){var n=(e[t].vertices[o][0]-e.x)*e.scaleRatio+e.offsetX,i=(e[t].vertices[o][1]-e.y)*e.scaleRatio+e.offsetY;e[t].vertices[o][0]=n,e[t].vertices[o][1]=i}return e},g=function(e,t){e.x=e[0].vertices[0][0],e.X=0,e.y=e[0].vertices[0][1],e.Y=0;for(var o=0;o<e.length;o++){var n=d(e.x,e.X,e.y,e.Y,e[o].vertices);e.x=n.x,e.X=n.X,e.y=n.y,e.Y=n.Y}return e.X=e.X-e.x,e.Y=e.Y-e.y,e.scaleRatio=t.width/e.X*e.Y<t.height?t.width/e.X:t.height/e.Y,e},h=function(n){i=o[0].querySelector("canvas"),o[0].removeEventListener("mousedown",v,!0);var r='<canvas class="c-ckanvas__canvas"></canvas>';t.transformControls?(void 0===t.zoom&&(t.zoom=1),void 0===t.offsetX&&(t.offsetX=0),void 0===t.offsetY&&(t.offsetY=0),-1===o[0].className.indexOf("c-ckanvas__tranform")&&(o[0].className+=" c-ckanvas__tranform"),r+='<div class="c-ckanvas__zoom-buttons"><button ng-click="zoom=zoom+.25" class="c-ckanvas__zoom-buttons_plus">+</button><button ng-click="zoom=zoom-.25" class="c-ckanvas__zoom-buttons_minus">-</button></div>'):o[0].className.indexOf("c-ckanvas__tranform")>-1&&(o[0].className=o[0].className.split("c-ckanvas__tranform").join("")),t.miniMap,o.html(r),e(o.contents())(t),i=o[0].querySelectorAll("canvas")[0],i.width=o[0].offsetWidth,i.height=o[0].offsetHeight;var c=i.getContext("2d"),f=window.devicePixelRatio||1,l=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1,d=f/l*(t.zoom?t.zoom:1);if(f!==l){c.scale(d,d);var h=i.width,p=i.height;c.canvas.width=h*d,c.canvas.height=p*d,t.responsive?(i.style.width="100%",i.style.height="100%"):(i.style.width=h+"px",i.style.height=p+"px")}n=g(n,i);var y=t.center;y||void 0===y?(n.offsetX=(i.width-n.X*n.scaleRatio)/2,n.offsetY=(i.height-n.Y*n.scaleRatio)/2):(n.offsetX=0,n.offsetY=0),n=m(n),void 0===t.zoom&&void 0===t.offsetX&&void 0===t.offsetY||(s=o[0].querySelector("button.c-ckanvas__zoom-buttons_minus"),a()),t.transformControls&&o[0].addEventListener("mousedown",v,!0);for(var X=0;X<n.length;X++)u(X,c,n)};if(h(angular.copy(t.paths)),t.$watch(function(){return t.paths},function(e,o){e!==o&&h(angular.copy(t.paths))}),t.$watch(function(){return t.zoom},function(e,o){e!==o&&h(angular.copy(t.paths))}),t.responsive){var p=o[0].getBoundingClientRect().width,y=o[0].getBoundingClientRect().height;setInterval(function(){p===o[0].getBoundingClientRect().width&&y===o[0].getBoundingClientRect().height||(p=o[0].getBoundingClientRect().width,y=o[0].getBoundingClientRect().height,h(angular.copy(t.paths)))},100)}}}}])}(angular.module("cKanvas",[]));
//# sourceMappingURL=ckanvas.min.js.map