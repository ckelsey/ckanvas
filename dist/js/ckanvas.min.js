!function(e){e.directive("ckanvas",["$compile",function(e){return{restrict:"E",scope:{center:"@center",miniMap:"@miniMap",offsetX:"@offsetX",offsetY:"@offsetY",paths:"=paths",responsive:"@responsive",transformControls:"@transformControls",zoom:"@zoom"},link:function(t,o,n){var s=null,i=null,a=function(){t.zoom<1&&(t.zoom=1),1===t.zoom?i.className=-1===i.className.indexOf("c-ckanvas__zoom-button-disabled")?i.className+" c-ckanvas__zoom-button-disabled":i.className:i.className=i.className.split("c-ckanvas__zoom-button-disabled").join("");var e="translate("+(t.offsetX?t.offsetX+"px":"0px")+", "+(t.offsetY?t.offsetY+"px":"0px")+") scale("+(t.zoom?t.zoom:"1")+")",o=50,n=50;t.offsetX&&(o=(s.width-t.offsetX)/s.width*100-90),t.offsetY&&(n=(s.height-t.offsetY)/s.height*100-50);var a=o+"% "+n+"%";s.style.webkitTransform=e,s.style.webkitTransformOrigin=a,s.style.MozTransform=e,s.style.MozTransformOrigin=a,s.style.msTransform=e,s.style.msTransformOrigin=a,s.style.OTransform=e,s.style.OTransformOrigin=a,s.style.transform=e,s.style.transformOrigin=a},r=function(e){e.target;document.body.removeEventListener("mousemove",l,!0),document.body.removeEventListener("mouseleave",r,!0),document.body.removeEventListener("mouseup",r,!0)},c=0,f=0,l=function(e){var o=e.pageX-s.getBoundingClientRect().left,n=e.pageY-s.getBoundingClientRect().top;t.offsetX=t.offsetX+(o-c),t.offsetY=t.offsetY+(n-f),a()},m=function(e){c=e.pageX-s.getBoundingClientRect().left,f=e.pageY-s.getBoundingClientRect().top,document.body.addEventListener("mousemove",l,!0),document.body.addEventListener("mouseleave",r,!0),document.body.addEventListener("mouseup",r,!0)},v=function(e,t,o){for(var n in o[e].properties)t[n]=o[e].properties[n];t.beginPath(),t.moveTo(o[e].vertices[0][0],o[e].vertices[0][1]);for(var s=1;s<o[e].vertices.length;s++){var i=o[e].vertices[s][0],a=o[e].vertices[s][1];t.lineTo(i,a)}t.closePath(),o[e].properties.fillStyle&&t.fill(),o[e].properties.strokeStyle&&t.stroke()},u=function(e,t,o,n,s){for(var i=0;i<s.length;i++)s[i][0]>t&&(t=s[i][0]),s[i][0]<e&&(e=s[i][0]),s[i][1]>n&&(n=s[i][1]),s[i][1]<o&&(o=s[i][1]);return{x:e,X:t,y:o,Y:n}},d=function(e){for(var t=0;t<e.length;t++)for(var o=0;o<e[t].vertices.length;o++){var n=(e[t].vertices[o][0]-e.x)*e.scaleRatio+e.offsetX,s=(e[t].vertices[o][1]-e.y)*e.scaleRatio+e.offsetY;e[t].vertices[o][0]=n,e[t].vertices[o][1]=s}return e},g=function(e,t){e.x=e[0].vertices[0][0],e.X=0,e.y=e[0].vertices[0][1],e.Y=0;for(var o=0;o<e.length;o++){var n=u(e.x,e.X,e.y,e.Y,e[o].vertices);e.x=n.x,e.X=n.X,e.y=n.y,e.Y=n.Y}return e.X=e.X-e.x,e.Y=e.Y-e.y,e.scaleRatio=t.width/e.X*e.Y<t.height?t.width/e.X:t.height/e.Y,e},h=function(n){o[0].removeEventListener("mousedown",m,!0);var r='<canvas class="c-ckanvas__canvas"></canvas>';t.transformControls?(void 0===t.zoom&&(t.zoom=1),void 0===t.offsetX&&(t.offsetX=0),void 0===t.offsetY&&(t.offsetY=0),-1===o[0].className.indexOf("c-ckanvas__tranform")&&(o[0].className+=" c-ckanvas__tranform"),r+='<div class="c-ckanvas__zoom-buttons"><button ng-click="zoom=zoom+.25" class="c-ckanvas__zoom-buttons_plus">+</button><button ng-click="zoom=zoom-.25" class="c-ckanvas__zoom-buttons_minus">-</button></div>'):o[0].className.indexOf("c-ckanvas__tranform")>-1&&(o[0].className=o[0].className.split("c-ckanvas__tranform").join("")),t.miniMap,o.html(r),e(o.contents())(t),s=o[0].querySelectorAll("canvas")[0],s.width=o[0].offsetWidth,s.height=o[0].offsetHeight;var c=s.getContext("2d"),f=window.devicePixelRatio||1,l=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1,u=f/l*(t.zoom?t.zoom:1);if(f!==l){c.scale(u,u);var h=s.width,p=s.height;c.canvas.width=h*u,c.canvas.height=p*u}t.responsive?(s.style.width="100%",s.style.height="100%"):(s.style.width=h+"px",s.style.height=p+"px"),n=g(n,s);var y=t.center;y||void 0===y?(n.offsetX=(s.width-n.X*n.scaleRatio)/2,n.offsetY=(s.height-n.Y*n.scaleRatio)/2):(n.offsetX=0,n.offsetY=0),n=d(n),void 0===t.zoom&&void 0===t.offsetX&&void 0===t.offsetY||(i=o[0].querySelector("button.c-ckanvas__zoom-buttons_minus"),a()),t.transformControls&&o[0].addEventListener("mousedown",m,!0);for(var z=0;z<n.length;z++)v(z,c,n)};if(t.paths&&t.paths.length&&h(angular.copy(t.paths)),t.$watch(function(){return t.paths},function(e,o){e!==o&&h(angular.copy(t.paths))}),t.$watch(function(){return t.zoom},function(e,o){e!==o&&h(angular.copy(t.paths))}),t.responsive){var p=o[0].getBoundingClientRect().width,y=o[0].getBoundingClientRect().height;setInterval(function(){p===o[0].getBoundingClientRect().width&&y===o[0].getBoundingClientRect().height||(p=o[0].getBoundingClientRect().width,y=o[0].getBoundingClientRect().height,h(angular.copy(t.paths)))},100)}}}}])}(angular.module("cKanvas",[]));
//# sourceMappingURL=ckanvas.min.js.map