!function(t){t.directive("ckanvas",["$compile",function(t){return{restrict:"E",scope:{center:"@center",miniMap:"@miniMap",offsetX:"@offsetX",offsetY:"@offsetY",paths:"=paths",responsive:"@responsive",transformControls:"@transformControls",zoom:"@zoom"},link:function(e,o,n){var s=null,i=null,a=function(){e.zoom<1&&(e.zoom=1),1===e.zoom?i.className=-1===i.className.indexOf("c-ckanvas__zoom-button-disabled")?i.className+" c-ckanvas__zoom-button-disabled":i.className:i.className=i.className.split("c-ckanvas__zoom-button-disabled").join("");var t="translate("+(e.offsetX?e.offsetX+"px":"0px")+", "+(e.offsetY?e.offsetY+"px":"0px")+") scale("+(e.zoom?e.zoom:"1")+")",o=50,n=50;e.offsetX&&(o=(s.width-e.offsetX)/s.width*100-90),e.offsetY&&(n=(s.height-e.offsetY)/s.height*100-50),transformOrigin=o+"% "+n+"%",s.style.webkitTransform=t,s.style.webkitTransformOrigin=transformOrigin,s.style.MozTransform=t,s.style.MozTransformOrigin=transformOrigin,s.style.msTransform=t,s.style.msTransformOrigin=transformOrigin,s.style.OTransform=t,s.style.OTransformOrigin=transformOrigin,s.style.transform=t,s.style.transformOrigin=transformOrigin},r=function(t){t.target;document.body.removeEventListener("mousemove",l,!0),document.body.removeEventListener("mouseleave",r,!0),document.body.removeEventListener("mouseup",r,!0)},c=0,f=0,l=function(t){var o=t.pageX-s.getBoundingClientRect().left,n=t.pageY-s.getBoundingClientRect().top;e.offsetX=e.offsetX+(o-c),e.offsetY=e.offsetY+(n-f),a()},m=function(t){c=t.pageX-s.getBoundingClientRect().left,f=t.pageY-s.getBoundingClientRect().top,document.body.addEventListener("mousemove",l,!0),document.body.addEventListener("mouseleave",r,!0),document.body.addEventListener("mouseup",r,!0)},v=function(t,e,o){for(var n in o[t].properties)e[n]=o[t].properties[n];e.beginPath(),e.moveTo(o[t].vertices[0][0],o[t].vertices[0][1]);for(var s=1;s<o[t].vertices.length;s++){var i=o[t].vertices[s][0],a=o[t].vertices[s][1];e.lineTo(i,a)}e.closePath(),o[t].properties.fillStyle&&e.fill(),o[t].properties.strokeStyle&&e.stroke()},u=function(t,e,o,n,s){for(var i=0;i<s.length;i++)s[i][0]>e&&(e=s[i][0]),s[i][0]<t&&(t=s[i][0]),s[i][1]>n&&(n=s[i][1]),s[i][1]<o&&(o=s[i][1]);return{x:t,X:e,y:o,Y:n}},g=function(t){for(var e=0;e<t.length;e++)for(var o=0;o<t[e].vertices.length;o++){var n=(t[e].vertices[o][0]-t.x)*t.scaleRatio+t.offsetX,s=(t[e].vertices[o][1]-t.y)*t.scaleRatio+t.offsetY;t[e].vertices[o][0]=n,t[e].vertices[o][1]=s}return t},d=function(t,e){t.x=t[0].vertices[0][0],t.X=0,t.y=t[0].vertices[0][1],t.Y=0;for(var o=0;o<t.length;o++){var n=u(t.x,t.X,t.y,t.Y,t[o].vertices);t.x=n.x,t.X=n.X,t.y=n.y,t.Y=n.Y}return t.X=t.X-t.x,t.Y=t.Y-t.y,t.scaleRatio=e.width/t.X*t.Y<e.height?e.width/t.X:e.height/t.Y,t},h=function(n){o[0].removeEventListener("mousedown",m,!0);var r='<canvas class="c-ckanvas__canvas"></canvas>';e.transformControls?(void 0===e.zoom&&(e.zoom=1),void 0===e.offsetX&&(e.offsetX=0),void 0===e.offsetY&&(e.offsetY=0),-1===o[0].className.indexOf("c-ckanvas__tranform")&&(o[0].className+=" c-ckanvas__tranform"),r+='<div class="c-ckanvas__zoom-buttons"><button ng-click="zoom=zoom+.25" class="c-ckanvas__zoom-buttons_plus">+</button><button ng-click="zoom=zoom-.25" class="c-ckanvas__zoom-buttons_minus">-</button></div>'):o[0].className.indexOf("c-ckanvas__tranform")>-1&&(o[0].className=o[0].className.split("c-ckanvas__tranform").join("")),e.miniMap,o.html(r),t(o.contents())(e),s=o[0].querySelectorAll("canvas")[0],s.width=o[0].offsetWidth,s.height=o[0].offsetHeight;var c=s.getContext("2d"),f=window.devicePixelRatio||1,l=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1,u=f/l*(e.zoom?e.zoom:1);if(f!==l){c.scale(u,u);var h=s.width,p=s.height;c.canvas.width=h*u,c.canvas.height=p*u}e.responsive?(s.style.width="100%",s.style.height="100%"):(s.style.width=h+"px",s.style.height=p+"px"),n=d(n,s);var y=e.center;y||void 0===y?(n.offsetX=(s.width-n.X*n.scaleRatio)/2,n.offsetY=(s.height-n.Y*n.scaleRatio)/2):(n.offsetX=0,n.offsetY=0),n=g(n),void 0===e.zoom&&void 0===e.offsetX&&void 0===e.offsetY||(i=o[0].querySelector("button.c-ckanvas__zoom-buttons_minus"),a()),e.transformControls&&o[0].addEventListener("mousedown",m,!0);for(var z=0;z<n.length;z++)v(z,c,n)};if(h(angular.copy(e.paths)),e.$watch(function(){return e.paths},function(t,o){t!==o&&h(angular.copy(e.paths))}),e.$watch(function(){return e.zoom},function(t,o){t!==o&&h(angular.copy(e.paths))}),e.responsive){var p=o[0].getBoundingClientRect().width,y=o[0].getBoundingClientRect().height;setInterval(function(){p===o[0].getBoundingClientRect().width&&y===o[0].getBoundingClientRect().height||(p=o[0].getBoundingClientRect().width,y=o[0].getBoundingClientRect().height,h(angular.copy(e.paths)))},100)}}}}])}(angular.module("cKanvas",[]));
//# sourceMappingURL=ckanvas.min.js.map